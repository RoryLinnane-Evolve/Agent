@using Ragent.Agent
@using Ragent.Agent.Messages
@using RazorConsole.Components
@using Spectre.Console
@using Markup = Spectre.Console.Markup
@using Panel = RazorConsole.Components.Panel

<Panel BorderColor="Color.Salmon1">
    @foreach(var item in Agent.ChatHistory)
    {
        <p>@(Markup.Escape(item.PrettyString()))</p>
        <Newline />
    }
    <TextInput @bind-Value="currentInput" Placeholder="Type your message here..." OnSubmit="SendMessage" Expand="true" />
</Panel>

@code{
    [Parameter]
    public required Agent Agent { get; set; }
    
    private string currentInput = string.Empty;

    protected override void OnInitialized() {
        base.OnInitialized();
        Agent.OnMessageReceived += StateHasChanged;
    }

    async void SendMessage() {

        await Agent.ProcessMessage(currentInput);

    }
}

